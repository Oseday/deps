<html lang="en">
	<link type="text/css" rel="stylesheet" id="dark-mode-general-link">
	<link type="text/css" rel="stylesheet" id="dark-mode-custom-link">

	<style type="text/css" id="dark-mode-custom-style"></style>
	<head>
		<link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
		<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="manifest" href="https://verbipati.org/manifest.webmanifest">
		<meta name="msapplication-TileColor" content="#ffffff">
		<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
		<meta name="theme-color" content="#ffffff">
		<meta name="mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-title" content="VerBiPati">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<meta name="application-name" content="VerBiPati">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="VerBiPati web app for dogs and cats">

		<script type="module" src="/pwabuilder-sw-register.js"></script>

		<!-- Bootstrap core CSS -->
		<link href="https://verbipati.org/bootstrap-4.5.2-dist/css/bootstrap.min.css" rel="stylesheet">

		<meta name="theme-color" content="#563d7c">

		<style type="text/css">
			* { box-sizing: border-box; }

			.grid:after {
			  content: '';
			  display: block;
			  clear: both;
			}

			.grid-sizer,
			.grid-item {
			  width: 20%;
			}
			@media (max-width: 360px) {
			  .grid-sizer,
			  .grid-item {
				width: 50%;
			  }
			}
			@media (min-width: 361px) and (max-width: 760px) {
			  .grid-sizer,
			  .grid-item {
				width: 33.333%;
			  }
			}

			.grid-item {
			  float: left;
			}

			.grid-item img {
			  display: block;
			  max-width: 100%;
			}

			.animal-container {
				background-color: #c0c0c0;
				padding-top: 4px;
				padding-bottom: 16px;
				margin-bottom: 8px;
			}

			.no-padding{
				padding: 0px;
				padding-top: 0px;
				padding-bottom: 0px;
				padding-left: 0px;
				padding-right: 0px;
			}

			.progress-extra{
				margin-left: 28px;
				margin-right: 28px;
				margin-bottom: 16px;
			}
		</style>

	</head>


	<body class="text-center" style="overflow-y: scroll">
			<title>VerBiPati Fotoğraf Kataloğu</title>
			<h1 class="text-center" id="greet">Fotoğraf Kataloğu</h1>

			<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#UploadModal" data-whatever="@mdo">Open modal for @mdo</button>

			<div class="modal fade" id="UploadModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="exampleModalLabel">Fotoğraf Ekle</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<input type="file" class="custom-file-input">yes</input>
							<div class="progress progress-extra"><div class="progress-bar" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div></div>
						</div>
					</div>
				</div>
			</div>


			<div class="col-12 no-padding" id="lists">
				
			</div>


	</body>


	<script src="https://verbipati.org/jquery.js" type="text/javascript"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/javascript.util/0.12.12/javascript.util.min.js" type="text/javascript"></script>
	<script src="https://verbipati.org/bootstrap-4.5.2-dist/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="https://verbipati.org/jscookies.js" type="text/javascript"></script>
	<script src="https://verbipati.org/getbrowser.js" type="text/javascript"></script>
	<script src="https://unpkg.com/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			var $grid = $('.grid').masonry({
			  itemSelector: '.grid-item',
			  percentPosition: true,
			  columnWidth: '.grid-sizer'
			});
			$grid.masonry();




			let hrefsplit = window.location.href.split("/")
			let locname = "test"//hrefsplit[hrefsplit.length-1]
			console.log(locname)
			
			async function SavePhoto(inp) {
				for (var i = inp.files.length - 1; i >= 0; i--) {
					try {
						let formData = new FormData();
						formData.append("photo", inp.files[i]);
						let r = await fetch('https://verbipati.org/photos/test', {method: "POST", body: formData}); 
						console.log('Upload HTTP response code:',r.status); 
					} catch(e) {
						console.log('error:', e);
					}
				}
			}



			var locationDataP;

			function GetLocText(rowData,coords) {
				let locationName = rowData[0]
				let details = rowData[5]

				return `<d>${locationName}<i><small>  ${details} </small></i></d>`
			}
//cd deps/ose && git pull origin master && cd ../.. && sudo ./luvit server.lua
//<div class="progress progress-extra" hidden><div class="progress-bar" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div></div>

			function UpdateForm(data,coords){
				//console.log(data)
				$("#lists").empty();
				locationDataP = data;
				for(let [animalname, rowData] of Object.entries(data)){

					let str = "";

					console.log(animalname)
					console.log(rowData)

					let trs = `
							<div class="animal-container">
								<h3 class="text-center text-capitalize">${animalname} <a class="btn btn-outline-dark btn-sm" data-toggle="modal" id="openmodal" data-target="#UploadModal" data-whatever="${animalname}">+</a> </h3> 
								<div class="container-fluid no-padding">
								  	<div class="grid">
										<div class="grid-sizer"></div>`;

					for(let [_, animalphoto] of Object.entries(rowData)){		
						trs = trs + `<div class="grid-item"> <img src="https://verbipati.org/photos/${locname}/${animalname}/${animalphoto}" alt="image" title="${animalname}"></img> </div>`;
					}

					trs = trs + `</div> </div> </div>`;

					$("#lists").append(trs);
				}

				$('#UploadModal').on('show.bs.modal', function (event) {
					var button = $(event.relatedTarget) // Button that triggered the modal
					var recipient = button.data('whatever') // Extract info from data-* attributes
					// If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
					// Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
					var modal = $(this)
					//modal.find('.modal-title').text('New message to ' + recipient)
					//modal.find('.modal-body input').val(recipient)
				})

				$('#openmodal').click(function() {
					$('.modal').modal('show');
				})
				
				$(".list-group-item").click(function(){
					console.log(this.id);
					href = `/photos/${this.id}`;
				})
			}

			$.post(`https://verbipati.org/photosmeta/${locname}`).done(function(data) {
				UpdateForm(data)
			}).fail(function(){
				//document.location.href = "/viewer";
			})


		});
	</script>


</html>